create table chat_room (id uuid not null, created_at timestamp, last_modified_at timestamp, name varchar(30) not null, owner_id int8, primary key (id));
create table chat_user (id int8 generated by default as identity, created_at timestamp, last_modified_at timestamp, chat_room_id uuid not null, chatter_id int8 not null, primary key (id));
create table distribution (id int8 generated by default as identity, created_at timestamp, last_modified_at timestamp, amount int4 not null, targets int4 not null, token varchar(3) not null, chat_room_id uuid, distributor_id int8, primary key (id));
create table k_user (id int8 generated by default as identity, created_at timestamp, last_modified_at timestamp, name varchar(20) not null, primary key (id));
create table receipt (id int8 generated by default as identity, created_at timestamp, last_modified_at timestamp, amount int4 not null, receiver_id int8, status varchar(255), version int8, distribution_id int8, primary key (id));
create index IDX_CHAT_USER__CHAT_ROOM on chat_user (chat_room_id);
create index IDX_CHAT_USER__KUSER on chat_user (chatter_id);
alter table if exists distribution add constraint IDX_DISTRIBUTION__TOKEN unique (token);
alter table if exists chat_room add constraint FK2o09gcd4q4v1m6km8o42cfs92 foreign key (owner_id) references k_user;
alter table if exists chat_user add constraint FK67fgnu7l9ghfnf79aj7p316rx foreign key (chat_room_id) references chat_room;
alter table if exists chat_user add constraint FKprddbe6i4nc4fb972o3acbk0s foreign key (chatter_id) references k_user;
alter table if exists distribution add constraint FK1xy6etwj5rl2s9hm4yblm3kc4 foreign key (chat_room_id) references chat_room;
alter table if exists distribution add constraint FK3fovrlhmpt0wru81073ousmeh foreign key (distributor_id) references k_user;
alter table if exists receipt add constraint FKv50xjl172mpx8ufs55oxq3iw foreign key (distribution_id) references distribution;

-- truncate table receipt restart identity cascade;
-- truncate table distribution restart identity cascade;
-- truncate table chat_user restart identity cascade;
-- truncate table chat_room restart identity cascade;
-- truncate table k_user restart identity cascade;

insert into k_user (id, name, created_at, last_modified_at) values
(1, 'ㅋㅋㅇ', now(), now()),
(2, '콩심은데콩나고팥심은데팥난다꼭명심하세요', now(), now()),
(3, 'Guile', now(), now()),
(4, '김갑환', now(), now()),
(5, 'Chun Li', now(), now()),
(6, 'Kyoshiro', now(), now()),
(7, 'Haomaru', now(), now()),
(8, 'Charlotte', now(), now()),
(9, 'Bruce', now(), now())
;

insert into chat_room (id, name, owner_id, created_at, last_modified_at) values
('4cf5507010ae4097afcfd61a25cfd233', '방1', 1, now(), now()),
('74b45ce509394effbcd38a6277066252', '방2', 2, now(), now()),
('b7dd1bf7bf2048f898ff558f04faa35f', '방3', 2, now(), now()),
('c70f1bbc787d4706aac154cc609997ca', '방4', 2, now(), now()),
('cf12c71ee81e4c419750187f670b0847', '방5', 3, now(), now()),
('f5addd512d4547a28d15d95ece9b21b8', '방6', 5, now(), now()),
('396d7ac2aa654f568ec1ccc8b88b332c', '방7', 5, now(), now()),
('23662be4223042c9a93ba58049fbd414', '방8', 7, now(), now()),
('c2cef0fb71084f5e92e39b3011f77fbf', '방9', 9, now(), now())
;

insert into chat_user (chat_room_id, chatter_id, created_at, last_modified_at) values
('4cf5507010ae4097afcfd61a25cfd233', 1, now(), now()),
('4cf5507010ae4097afcfd61a25cfd233', 2, now(), now()),
('4cf5507010ae4097afcfd61a25cfd233', 3, now(), now()),
('4cf5507010ae4097afcfd61a25cfd233', 4, now(), now()),
('4cf5507010ae4097afcfd61a25cfd233', 5, now(), now()),
('74b45ce509394effbcd38a6277066252', 2, now(), now()),
('b7dd1bf7bf2048f898ff558f04faa35f', 2, now(), now()),
('b7dd1bf7bf2048f898ff558f04faa35f', 4, now(), now()),
('b7dd1bf7bf2048f898ff558f04faa35f', 6, now(), now()),
('c70f1bbc787d4706aac154cc609997ca', 2, now(), now()),
('cf12c71ee81e4c419750187f670b0847', 3, now(), now()),
('f5addd512d4547a28d15d95ece9b21b8', 5, now(), now()),
('396d7ac2aa654f568ec1ccc8b88b332c', 5, now(), now()),
('23662be4223042c9a93ba58049fbd414', 7, now(), now()),
('c2cef0fb71084f5e92e39b3011f77fbf', 9, now(), now())
;

insert into distribution (token, amount, targets, distributor_id, chat_room_id, created_at, last_modified_at) values
('a11', 100, 2, 1, '4cf5507010ae4097afcfd61a25cfd233', current_timestamp - (20 || ' minutes')::interval, current_timestamp - (20 || ' minutes')::interval),
('a21', 400, 4, 2, '4cf5507010ae4097afcfd61a25cfd233', current_timestamp - (10 || ' days')::interval, current_timestamp - (10 || ' days')::interval),
('c41', 300, 1, 4, 'b7dd1bf7bf2048f898ff558f04faa35f', now(), now())
;

insert into receipt (receiver_id, amount, distribution_id, status, version, created_at, last_modified_at) values
(null, 50, 1, 'OPEN', 1, now(), now()),
(null, 50, 1, 'OPEN', 1, now(), now()),
(null, 100, 2, 'OPEN', 1, now(), now()),
(null, 100, 2, 'OPEN', 1, now(), now()),
(null, 100, 2, 'OPEN', 1, now(), now()),
(null, 100, 2, 'OPEN', 1, now(), now()),
(null, 300, 3, 'OPEN', 1, now(), now())
;
